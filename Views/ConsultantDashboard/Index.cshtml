@model HMS.Models.PatientMasterModel
@{
    Layout = "~/Views/Shared/_CounsultantLayout.cshtml";
    HMS.Common.EncryptDecrypt encDecr = new HMS.Common.EncryptDecrypt();
    string Action = ViewContext.RouteData.Values["action"].ToString();
    string Controller = ViewContext.RouteData.Values["controller"].ToString();
}
<div class="page-header">
    <div class="page-leftheader">
        <h4 class="page-title mb-0">DashBoard </h4>
        </>
    </div>
</div>
@using (Html.BeginForm(Action, Controller, null, FormMethod.Post))
{
    <h1 style="text-align:center">Welcome @ViewBag.Consultantname </h1>
    <h5 style="text-align:center">@ViewBag.Currentdate &ensp;||&ensp; Start Time :-@ViewBag.StartedTime &ensp;-&ensp; End Time :-@ViewBag.EndedTime</h5>
    
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">Total Patients</p>
                            <h2 class="mb-1 ">@ViewBag.totalPatient</h2>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">New Patients</p>
                            <h2 class="mb-1 ">@ViewBag.todayPatient</h2>
                            @* <p class="mb-0 text-muted"><span class="text-danger">(+0.54%)</span><i class="fe fe-arrow-down text-danger"></i>Decrease</p> *@
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">Total Services</p>
                            <h2 class="mb-1 ">@ViewBag.totalServices</h2>
                            @* <p class="mb-0 text-muted"><span class="text-danger">(+0.54%)</span><i class="fe fe-arrow-down text-danger"></i>Decrease</p> *@
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">Total Collections</p>
                            <h2 class="mb-1 ">

                                <p class="card-text">
                                    Net Amount = <span id="netAmount">*******</span>
                                    <i id="toggleIcon" class="fa fa-eye-slash" aria-hidden="true"></i>
                                </p>
                                <p class="card-text"></p>
                            </h2>
                            @* <p class="mb-0 text-muted"><span class="text-danger">(+0.54%)</span><i class="fe fe-arrow-down text-danger"></i>Decrease</p> *@
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">Patient Checked</p>
                            <h2 class="mb-1 ">@ViewBag.patientIsChecked</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6 col-xl-3">
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="">
                            <p class="mb-2 h6">Patients Checked Pending</p>
                            <h2 class="mb-1 ">@ViewBag.PatienIsCheckedpending</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
    <div class="row">
        <div class="col-xl-12 product">
            <div class="card">
                <div class="card-body" style="text-align:center;" >
                    <label for="yearDropdown">Select Year : </label>
                    <select id="yearDropdown" name="year"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-6 product">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Total Patients</h3>
                    <div class="card-options ">
                        <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                        <a href="#" class="card-options-fullscreen" data-toggle="card-fullscreen"><i class="fe fe-maximize"></i></a>
                        <a href="#" class="card-options-remove" data-toggle="card-remove"><i class="fe fe-x"></i></a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-12 col-xl-12">
                            <div class="chart-wrapper">
                                <div class="chart-wrapper">

                                    <canvas id="TotalPatientChart" class="chartjs-render-monitor chart-dropshadow2 overflow-hidden"></canvas>
                                </div>

                            </div>
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 product">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Total Collection</h3>
                    <div class="card-options ">
                        <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                        <a href="#" class="card-options-fullscreen" data-toggle="card-fullscreen"><i class="fe fe-maximize"></i></a>
                        <a href="#" class="card-options-remove" data-toggle="card-remove"><i class="fe fe-x"></i></a>
                    </div>
                </div>
                <div class="card-body">
                    @* <div class="row">
                        <label for="yearDropdown">Select Year:</label>
                        <select id="yearDropdown" name="year"></select>
                    </div> *@
                    <div class="row">
                        <div class="col-lg-12 col-xl-12">
                            <div class="chart-wrapper">
                                <div class="chart-wrapper">
                                    <canvas id="AmountChart" class="chartjs-render-monitor chart-dropshadow2 overflow-hidden"></canvas>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
}
<style>
    .hidden-amount {
        display: none;
    }

    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    label {
        font-size: 16px;
        margin-right: 10px;
    }

    select {
        font-size: 16px;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        outline: none;
    }

        select:focus {
            border-color: #007BFF;
        }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- jQuery (optional if you want to use jQuery) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var netAmountValue = '@ViewBag.netamount';  // Store the original net amount
        $('#toggleIcon').click(function () {
            var netAmountSpan = $('#netAmount');
            if (netAmountSpan.data('visible')) {
                netAmountSpan.text('*******');
                netAmountSpan.data('visible', false);
                $('#toggleIcon').removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                netAmountSpan.text(netAmountValue);
                netAmountSpan.data('visible', true);
                $('#toggleIcon').removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });
        $('#netAmount').data('visible', false);  // Set initial state as hidden
    });

    function populateYearDropdown(startYear, endYear) {
        const yearDropdown = document.getElementById('yearDropdown');
        const currentYear = new Date().getFullYear();

        for (let year = startYear; year <= endYear; year++) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            if (year === currentYear) {
                option.selected = true;
            }
            yearDropdown.appendChild(option);
        }
    }

    window.onload = function () {
        const currentYear = new Date().getFullYear();
        populateYearDropdown(currentYear - 10, currentYear);  // Example: last 100 years and next 10 years
    }

  
    document.addEventListener('DOMContentLoaded', function () {
        // Function to update chart data based on selected year
        function updateChartData(year) {
            // Make an AJAX request to fetch data for the selected year
            fetch('/ConsultantDashboard/GetDataForYear?year=' + year)
                .then(response => response.json())
                .then(chartData => {
                    // Extract the labels and data from the fetched data
                    var labels = chartData.map(item => item.months);
                    var totalMonthCountData = chartData.map(item => item.totalMonthCount);
                    var sumOfTotalAmountData = chartData.map(item => item.sumOfTotalAmount);
                 console.log(chartData);
                    // Update the first chart with new data
                    barChart.data.labels = labels;
                    barChart.data.datasets[0].data = totalMonthCountData;
                    barChart.update();

                    // Update the second chart with new data
                    barChart1.data.labels = labels;
                    barChart1.data.datasets[0].data = sumOfTotalAmountData;
                    barChart1.update();
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Initialize the first chart
        var ctx = document.getElementById('TotalPatientChart').getContext('2d');
        var initialChartData = JSON.parse('@Html.Raw(ViewBag.Chartdata)');
        var initialLabels = initialChartData.map(item => item.Months);
        var initialTotalMonthCountData = initialChartData.map(item => item.TotalMonthCount);

        var config = {
            type: 'bar',
            data: {
                labels: initialLabels,
                datasets: [{
                    label: 'Total Count',
                    data: initialTotalMonthCountData,
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Months'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Total Count'
                        },
                        min: 0,
                        max: 10,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        };

        var barChart = new Chart(ctx, config);

        // Initialize the second chart
        var ctx1 = document.getElementById('AmountChart').getContext('2d');
        var initialSumOfTotalAmountData = initialChartData.map(item => item.SumOfTotalAmount);

        var config1 = {
            type: 'bar',
            data: {
                labels: initialLabels,
                datasets: [{
                    label: 'Sum Of Total Amount',
                    data: initialSumOfTotalAmountData,
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Months'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Sum Of Total Amount'
                        },
                        min: 0,
                        max: 5000,
                        ticks: {
                            stepSize: 1000
                        }
                    }
                }
            }
        };

        var barChart1 = new Chart(ctx1, config1);

        // Event listener for dropdown change
        document.getElementById('yearDropdown').addEventListener('change', function () {
            var selectedYear = this.value;
            updateChartData(selectedYear);
        });
    });

</script>

